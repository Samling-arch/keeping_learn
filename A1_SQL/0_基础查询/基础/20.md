好的，同学！我们来把 `LIMIT` 和 `DISTINCT` 这两个 SQL 关键字掰开揉碎了讲清楚。这节课会非常轻松，但内容却非常实用！

首先，我们用一个表格来总结今天的主角。

| 关键字 | 一句话概括 | 语法格式 | 核心作用 |
| --- | --- | --- | --- |
| `LIMIT` | 从一大堆数据里，只捞出我想要的**某一段**。 | `LIMIT n` <br> `LIMIT m, n` | 限制查询结果返回的记录数量，常用于分页、获取Top-N排名。 |
| `DISTINCT` | 把查询结果里**一模一样**的记录，只保留一条。 | `SELECT DISTINCT column_name(s) FROM table_name;` | 对查询结果进行去重，查看不重复的数据类别。 |

---

# 1 SQL 查询记录：LIMIT 与 DISTINCT

今天我们学习查询语句的最后两个关键字，它们非常简单，但在实际开发中用处巨大。

## 1.1 关键字一：LIMIT (记录条数限制)

### 1.1.1 # 核心概念

> **一句话概括：** `LIMIT` 就像一个切片工具，可以从查询结果中精确地切下任意一段数据给你。

想象一下，你的 `emp` 表里有成千上万条员工记录。你不可能一次性把所有数据都展示在网页上，对吧？`LIMIT` 就是用来解决这个问题的，它能帮你规定“从第几条开始，取多少条记录”。

### 1.1.2 # 语法详解

`LIMIT` 有两种基本用法，我们来逐一拆解。

#### 1.1.2.1 `LIMIT n`：取前 n 条记录

这个用法最简单，`n` 是一个数字，代表你想要获取的记录**数量**。

*   **语法格式：**
    $$
    SELECT column_name(s) FROM table_name LIMIT n;
    $$
*   **含义：**
    > 这表示从查询结果的**第 $1$ 条记录开始**，总共取出 **$n$ 条**记录。它默认的起始位置是 $0$ (即第一条)。

*   **例子：查询前 $10$ 条员工记录**
    假设我们想看看公司里最早入职的 $10$ 位员工（假设 `id` 是按入职顺序递增的）。

    ```sql
    -- 首先，我们看看全表数据有多少
    -- 假设执行后，我们看到有 32 条记录
    SELECT * FROM emp;

    -- 现在，使用 LIMIT 获取前 10 条
    SELECT * FROM emp LIMIT 10;
    ```
    *   **结果分析：**
        这条语句会返回 `id` 从 $1$ 到 $10$ 的员工记录。它不管你用什么字段排序，就按数据库返回结果的默认顺序，直接取走排在最前面的 $10$ 条。

#### 1.1.2.2 `LIMIT m, n`：跳过 m 条，再取 n 条

这个用法稍微复杂一点，但也是最强大的。它包含两个数字，用逗号隔开。

*   **语法格式：**
    $$
    SELECT column_name(s) FROM table_name LIMIT m, n;
    $$
*   **含义：**
    > **请注意！** 这里的 `m` 和 `n` 不是“开始位置”和“结束位置”。
    > *   `m`: 代表 **跳过（offset）** 的记录数。`LIMIT 2, ...` 意味着把前 $2$ 条记录忽略掉。
    > *   `n`: 代表 **获取（length/count）** 的记录数。`LIMIT ..., 5` 意味着从跳过的位置开始，再取 $5$ 条记录。

*   **例子：跨过前 $2$ 条，取 $4$ 条员工记录**
    我们想跳过 `id` 为 $1$ 和 $2$ 的员工，然后查看接下来的 $4$ 位员工。

    ```sql
    SELECT * FROM emp LIMIT 2, 4;
    ```
    *   **执行过程推演：**
        1.  SQL 引擎准备好了所有 $32$ 条记录。
        2.  看到 `LIMIT 2, 4`，它首先**跳过**前 $2$ 条记录（`id`=$1$ 和 `id`=$2$）。
        3.  然后，从第 $3$ 条记录开始，往后数 $4$ 条。
        4.  所以，最终返回的是 `id` 为 $3, 4, 5, 6$ 的这 $4$ 条记录。

*   **再举一例：`LIMIT 2, 2`**
    ```sql
    SELECT * FROM emp LIMIT 2, 2;
    ```
    *   **执行过程推演：**
        1.  **跳过**前 $2$ 条记录（`id`=$1$, `id`=$2$）。
        2.  从第 $3$ 条开始，往后数 $2$ 条。
        3.  最终返回的是 `id` 为 $3, 4$ 的这 $2$ 条记录。

### 1.1.3 # 实际应用场景

`LIMIT` 的语法很简单，但它的应用场景非常重要，尤其是以下两个。

#### 1.1.3.1 场景一：查询 Top-N 问题（比如：裁员名单）

> **需求：** 公司效益不好，需要裁掉**工资最高的 $5$ 个人**。

这是一个典型的 Top-N 查询。光用 `LIMIT` 是不够的，因为它不知道谁的工资“高”。

*   **错误思路：** 直接 `LIMIT 5`。这只会取出 `id` 前 $5$ 的员工，和工资完全没关系。
*   **正确思路：**
    1.  **排序（`ORDER BY`）：** 必须先把所有员工**按工资从高到低**排好队。
    2.  **取数（`LIMIT`）：** 从排好队的列表里，取出前 $5$ 个人。

*   **SQL 实现：**

    ```sql
    -- 步骤1：先按工资降序排序，看看结果对不对
    SELECT * FROM emp ORDER BY salary DESC;
    ```
    执行后，你会看到工资为 `$12000` 的排在最前面，然后是 `$10000` 的，等等。

    > **思考一个细节：** 如果好几个员工工资一样高（比如都是 `$12000`），裁谁不裁谁？这不公平！我们需要一个**第二裁员标准**，比如：**工资相同的情况下，裁年龄大的**。

    ```sql
    -- 步骤2：完善排序规则，增加年龄作为第二排序条件
    -- salary 和 age 都用 DESC（降序），表示优先裁工资高的，工资一样时裁年龄大的
    SELECT * FROM emp ORDER BY salary DESC, age DESC;
    ```
    现在，即使工资相同，也会按照年龄从大到小再次排序，名单就唯一确定了。

    ```sql
    -- 步骤3：最终执行裁员查询，加上 LIMIT
    SELECT * FROM emp ORDER BY salary DESC, age DESC LIMIT 5;
    ```
    **结果：** 这条语句精确地返回了按我们“裁员标准”排名前 $5$ 的员工信息。这就是 `ORDER BY` 和 `LIMIT` 的黄金组合！

#### 1.1.3.2 场景二：数据分页

> **一句话概括：** 分页的本质，就是用 `LIMIT` 不断地从数据库里切出一页一页的数据。

这是 `LIMIT` 最最常见的用途。网页上显示用户列表、商品列表时，都有“上一页”、“下一页”。

*   **分页逻辑：**
    *   假设**每页显示 $10$ 条**记录。
    *   **第 $1$ 页：** 显示第 $1 \sim 10$ 条记录。
        *   SQL: `SELECT * FROM emp LIMIT 0, 10;` (跳过 $0$ 条，取 $10$ 条。`LIMIT 10;` 也是一样的效果)
    *   **第 $2$ 页：** 用户点击“下一页”，我们想显示第 $11 \sim 20$ 条记录。
        *   SQL: `SELECT * FROM emp LIMIT 10, 10;` (跳过前 $10$ 条，再取 $10$ 条)
    *   **第 $3$ 页：** 用户再点击“下一页”，显示第 $21 \sim 30$ 条记录。
        *   SQL: `SELECT * FROM emp LIMIT 20, 10;` (跳过前 $20$ 条，再取 $10$ 条)

*   **分页公式：**
    如果用 `page` 代表当前页码（从 $1$ 开始），`pageSize` 代表每页的记录数，那么 `LIMIT` 的第一个参数 `m` (offset) 和第二个参数 `n` (count) 的关系是：
    $$
    m = (page - 1) * pageSize \\
    n = pageSize
    $$
    所以，获取第 `page` 页数据的通用SQL是：
    $$
    SELECT * FROM emp LIMIT (page - 1) * pageSize, pageSize;
    $$

## 1.2 关键字二：DISTINCT (查询去重)

### 1.2.1 # 核心概念

> **一句话概括：** `DISTINCT` 就像一个筛子，它会检查你查询出来的每一行结果，如果发现有两行或多行长得**一模一样**，就只留下一行。

### 1.2.2 # 什么时候`DISTINCT`没有用？

我们先思考一个问题：`SELECT * FROM emp;` 的结果里，可能有完全重复的记录吗？

*   **答案是：不可能！**
*   **来源：** 因为我们的 `emp` 表里有一个 `id` 字段，它是**主键 (Primary Key)**。主键的特性就是**非空且唯一**。只要有 `id` 字段在，哪怕其他所有字段（姓名、年龄、性别、工资）都完全相同，`id` 值也必然不同。
*   **结论：** 只要两条记录中**至少有一个字段的值不同**，它们就不是重复记录。

因此，当你查询的字段列表里包含了**主键**或者**带有唯一约束（`UNIQUE`）的列**时，使用 `DISTINCT` 是毫无意义的，因为结果本身就不可能重复。

```sql
-- 下面这条语句中，DISTINCT 是多余的，没有任何效果
-- 因为 `*` 包含了唯一的 id 字段
SELECT DISTINCT * FROM emp;
```

### 1.2.3 # 什么时候`DISTINCT`才有用？

当你的查询**没有**包含能保证唯一的字段，并且结果中**确实可能出现**完全一样的行时，`DISTINCT` 就派上用场了。

*   **例子：查询员工的（姓名，年龄）组合**
    假设我们想看看公司里有哪些（姓名，年龄）的组合。理论上，可能存在同名同龄的人。

    1.  **制造重复数据：** 为了演示，我们手动把两条记录改得一样。
        ```sql
        -- 假设我们把 id=2 的员工的 name 和 age 改成和 id=1 的一样
        -- UPDATE emp SET name = '乔治', age = 38 WHERE id = 2;
        ```
    2.  **不加`DISTINCT`的查询：**
        ```sql
        -- 我们只查询 name 和 age 这两列
        SELECT name, age FROM emp;
        ```
        *   **结果分析：** 结果集里会有 $32$ 行。因为我们修改了数据，你会看到至少有两条一模一样的行：`('乔治', 38)` 和 `('乔治', 38)`。

    3.  **加上`DISTINCT`的查询：**
        ```sql
        SELECT DISTINCT name, age FROM emp;
        ```
        *   **结果分析：** `DISTINCT` 会检查每一行结果。当它看到两个 `('乔治', 38)` 时，会认为它们是重复的，于是只保留一个。最终的结果集就只剩下 $31$ 行了。`DISTINCT` 成功去掉了重复项。

> **重要细节：** `DISTINCT` 作用于 `SELECT` 后面**所有的列**，而不是仅仅作用于它紧跟着的那一列。它判断的是**整行记录**是否重复。

### 1.2.4 # 实际应用场景

*   **场景一：查看公司所有员工的年龄构成**

    > **需求：** 我想知道，我们公司的员工都有哪些年龄？比如是不是只有 $25$ 岁、$30$ 岁、$38$ 岁这几种？

    ```sql
    -- 如果不加 DISTINCT，会列出所有32个员工的年龄，大量重复
    SELECT age FROM emp ORDER BY age;

    -- 加上 DISTINCT，就能看到独一无二的年龄值列表
    SELECT DISTINCT age FROM emp ORDER BY age;
    ```
    *   **结果：** 你会得到一个干净的列表，比如 `28, 32, 34, 38`...，清晰地展示了公司员工的所有年龄层。

*   **场景二：查看公司目前的薪资等级**

    > **需求：** 我想知道公司里都存在哪些薪资水平？

    ```sql
    -- 不加 DISTINCT，会列出所有人的工资
    SELECT salary FROM emp ORDER BY salary;

    -- 加上 DISTINCT，就能看到所有不重复的薪资值
    SELECT DISTINCT salary FROM emp ORDER BY salary;
    ```
    *   **结果：** 你会得到一个简洁的列表，如 `$6000, $7000, $8000, $9000, $10000, $12000`。这能让你快速了解公司的薪酬结构。

---

## 1.3 总结

好了同学，到此为止，我们查询记录的六个小节就全部讲完了。

*   `LIMIT` 负责**“切片”**，是实现分页和获取 Top-N 数据的核心工具，非常非常重要。
*   `DISTINCT` 负责**“去重”**，在需要分析数据类别（如年龄分布、薪资等级）时非常有用。

这两个关键字虽然简单，但它们和 `ORDER BY`、`WHERE` 等结合起来，能玩出很多花样。希望你课后一定多加练习，把这些知识点变成你自己的技能！