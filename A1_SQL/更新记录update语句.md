# 更新与删除记录 (第三、四节)
> 简单来说，这节课我们学习如何修改和删除数据，因为已经学了查询，所以修改和删除就变得很简单了，都是先查找到记录，再执行操作。
学完表记录的第一节添加记录，第二节查询记录，我们这节课即学习第三节和第四节的更新记录与删除记录。
因为我们已经学完了这个查询记录了，所以接下来咱们再做更新和删除会非常非常简单。你无论想更新哪些记录，你得先挑出来一些对吧？我们其实当然也可以对所有记录做一个统一的更新啊，但是就用的很少。
增删改查，各有一个关键字：
*   添加记录: `INSERT`
*   查询记录: `SELECT`
*   **更新记录**: `UPDATE`
*   **删除记录**: `DELETE`
删除跟更新也一样，你首先要查出来相应的记录，接下来是不是再进行一个`delete`即可。所以说因为咱们已经玩完了查询，所以更新和删除啊，就是一个水到渠成的事情。
## 更新记录 (UPDATE)
> 简单来说，要修改表里的某些数据，你得先用查询的办法把它们找出来，然后再用 `UPDATE` 命令一次性改掉。
### 更新记录的语法
> 咱们只需要把添加记录的 `INSERT INTO ... SET` 换成 `UPDATE`，就能修改表里已有记录的指定字段值了。
更新记录的语法和我们讲过的 `INSERT ... SET` 非常像。`INSERT ... SET` 是向表里添加一条新记录，而我们现在只需要把关键字 `INSERT INTO` 改成 `UPDATE`，就可以修改已有记录了。
$$
UPDATE 表名
SET 字段1 = 值1, 字段2 = 值2, ...
WHERE 条件;
$$
- `UPDATE 表名`: 指定要更新哪张表。
- `SET 字段 = 值`: 指定要修改哪个字段，以及它的新值是什么。可以同时修改多个字段，用逗号隔开。
- `WHERE 条件`: 这是一个筛选条件，告诉数据库**具体要更新哪些记录**。如果不加 `WHERE` 条件，就会对表里**所有**的记录进行统一的字段修改。
---
### 更新记录案例实操
> 接下来咱们通过一些具体的例子来练习一下更新操作。
首先，我们创建一个新的文件，起个名字 `SQL文件12`，内容是 **更新记录**。
#### 案例一：更新单个员工的薪资
> 我们可以精确地找到某一个员工，比如叫“苑老师”的，然后只修改他一个人的工资。
我想把苑老师的薪资调一下，比如把他的工资调成 `$1,000,000`。
```sql
-- 尝试将 name 为 'yuan' 的员工薪资更新为 100万
UPDATE emp 
SET salary = 1000000 
WHERE name = 'yuan';
```
执行后报错了，提示 `salary` 的值超出了范围。这是因为我们创建表结构的时候，给`salary`字段设置了大小限制 (总共`$7`位，小数点后`$2`位)，最大只能到`$99999.99`，所以`$1,000,000`是存不进去的。
那我们就改成一个合法的值，比如`$99,999`。
```sql
-- 正确写法：更新薪资为一个在允许范围内的值
UPDATE emp 
SET salary = 99999 
WHERE name = 'yuan';
```
执行成功。我们再查询 `emp` 表，就会发现 `yuan` 这条记录的 `salary` 字段已经被更新了。
![Pasted image 20231121151614.png](https://raw.githubusercontent.com/yuan-ge-git/image-hosting/main/Pasted%20image%2020231121151614.png)
#### 案例二：更新部门名称
> 我们可以批量修改符合某个条件的所有记录，比如把所有“运营部”都改名成“用户增长部”。
我想把所有 `运营部` 的部门，改个名字叫 `用户增长部`。
**注意一个细节**：我们是修改记录里面 `dep` 字段的**值**（比如从'运营部'改成'用户增长部'），而不是修改 `dep` 这个**字段本身的名称**。修改字段名需要用 `ALTER TABLE` 命令。
```sql
-- 将所有 dep 字段值为 '运营部' 的记录，其 dep 字段值更新为 '用户增长部'
UPDATE emp 
SET dep = '用户增长部' 
WHERE dep = '运营部';
```
这里的 `WHERE` 条件和 `SET` 操作都是围绕 `dep` 这一个字段展开的。执行后，我们再查看 `emp` 表，会发现原来的“运营部”都变成了“用户增长部”。
![Pasted image 20231121151740.png](https://raw.githubusercontent.com/yuan-ge-git/image-hosting/main/Pasted%20image%2020231121151740.png)
#### 案例三：为满足条件的员工按比例涨薪
> 修改数据时，新值不一定是个固定的数，也可以是基于原来的值进行计算得出的。
我们要给所有年龄大于 `$35` 岁的员工，工资增加 `$15`%。

```sql
UPDATE emp 
SET salary = salary * 1.15 
WHERE age > 35;
```
这里的 `SET` 语句有一个细节：`salary = salary * 1.15`。它的意思是，获取这个字段**当前的值**，将它乘以 `$1.15`，然后把计算出的新值再赋给自己。这很像编程语言里的自增运算。
比如 `Sarah` 年龄是 `$38`岁，符合 `age > 35` 的条件。她原来的工资是 `$10,000`，那么更新后她的新工资就是 `$10000 * 1.15 = 11500`。
执行后，提示有`$3`条记录被更新了。我们查看 `emp` 表，可以看到 `Sarah` 的薪资确实变成了 `$11,500`。
![Pasted image 20231121151859.png](https://raw.githubusercontent.com/yuan-ge-git/image-hosting/main/Pasted%20image%2020231121151859.png)
#### 案例四：为薪资最高的几个人降薪
> `UPDATE` 语句可以和 `ORDER BY`、`LIMIT` 结合使用，实现对排序后的前几条记录进行修改。
我们要找到薪资最高的 `$5` 个人，并给他们降薪 `$30`%。
这个案例把查询和更新的知识点结合起来了。我们需要先排序，再限制数量，最后执行更新。
**步骤一：先用 `SELECT` 查询一下，确认目标**
为了确保我们的操作是正确的，可以先查一下薪资最高的 `$5` 个人是谁。
```sql
-- 先查询，看看薪资最高的前5个人是谁
SELECT * FROM emp ORDER BY salary DESC LIMIT 5;
```
![Pasted image 20231121151959.png](https://raw.githubusercontent.com/yuan-ge-git/image-hosting/main/Pasted%20image%2020231121151959.png)
**步骤二：执行 `UPDATE` 操作**
确认目标后，我们就可以写出 `UPDATE` 语句了。降薪 `$30`% 相当于工资乘以 `$0.7`。
```sql
-- 对按薪资降序排列的前5条记录，执行降薪30%的操作
UPDATE emp 
SET salary = salary * 0.7 
ORDER BY salary DESC 
LIMIT 5;
```
执行成功后，我们再查看 `emp` 表。对比一下之前查询的结果：
- `yuan` 的薪资从 `$99,999` 变成了 `$70,000` 左右。
- `harry` 的薪资从 `$18,000` 变成了 `$12,600` 左右。
这证明我们成功地对查询并排序后的前`$5`条记录进行了更新。
![Pasted image 20231121152140.png](https://raw.githubusercontent.com/yuan-ge-git/image-hosting/main/Pasted%20image%2020231121152140.png)
好了，同学们，关于我们的这个更新，咱们就先给大家讲到这里。